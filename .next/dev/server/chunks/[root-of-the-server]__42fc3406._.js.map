{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/inventory-management-system/lib/db.ts"],"sourcesContent":["import mysql from 'mysql2/promise'\r\n\r\nconst pool = mysql.createPool({\r\n  host: process.env.DB_HOST || '127.0.0.1',\r\n  user: process.env.DB_USER || 'root',\r\n  password: process.env.DB_PASSWORD || '',\r\n  database: process.env.DB_DATABASE || 'kimchuyy_agrivet',\r\n  port: Number(process.env.DB_PORT || 3306),\r\n  waitForConnections: true,\r\n  connectionLimit: 10,\r\n  queueLimit: 0,\r\n})\r\n\r\nexport async function query(sql: string, params?: any[]) {\r\n  const [rows] = await pool.query(sql, params)\r\n  return rows\r\n}\r\n\r\nexport default pool\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC5B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;AACd;AAEO,eAAe,MAAM,GAAW,EAAE,MAAc;IACrD,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,KAAK,CAAC,KAAK;IACrC,OAAO;AACT;uCAEe"}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/inventory-management-system/app/api/products/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { query } from '@/lib/db'\r\nimport pool from '@/lib/db'\r\n\r\nexport async function GET(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const { id } = await params\r\n    const rows = await query(\r\n      `SELECT p.*, c.name as category_name FROM products p LEFT JOIN categories c ON p.category_id = c.category_id WHERE p.product_id = ?`,\r\n      [id],\r\n    )\r\n    if (!rows || (rows as any).length === 0) return NextResponse.json({ error: 'Not found' }, { status: 404 })\r\n    return NextResponse.json((rows as any)[0])\r\n  } catch (err) {\r\n    return NextResponse.json({ error: String(err) }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function PUT(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const { id } = await params\r\n    const body = await req.json()\r\n    const {\r\n      name,\r\n      category_id,\r\n      description,\r\n      sku,\r\n      price,\r\n      cost_price,\r\n      stock,\r\n      min_stock,\r\n      expiry_date,\r\n      is_archived,\r\n    } = body\r\n\r\n    const userId = req.headers.get('X-User-Id')\r\n    const conn = await pool.getConnection()\r\n    try {\r\n      await conn.beginTransaction()\r\n      await conn.query(\r\n        `UPDATE products SET category_id = ?, name = ?, description = ?, sku = ?, price = ?, cost_price = ?, stock = ?, min_stock = ?, expiry_date = ?, is_archived = ? WHERE product_id = ?`,\r\n        [category_id || null, name, description || null, sku || null, price || 0, cost_price || null, stock || 0, min_stock || 0, expiry_date || null, is_archived ? 1 : 0, id],\r\n      )\r\n\r\n      if (userId) {\r\n        await conn.query(\r\n          `INSERT INTO audit_logs (user_id, action, table_name, record_id, created_at) VALUES (?, 'UPDATE', 'products', ?, NOW())`,\r\n          [userId, id],\r\n        )\r\n      }\r\n\r\n      const [rows] = await conn.query(\r\n        `SELECT p.*, c.name as category_name FROM products p LEFT JOIN categories c ON p.category_id = c.category_id WHERE p.product_id = ?`,\r\n        [id],\r\n      )\r\n      await conn.commit()\r\n      return NextResponse.json((rows as any)[0])\r\n    } catch (err) {\r\n      await conn.rollback()\r\n      throw err\r\n    } finally {\r\n      conn.release()\r\n    }\r\n  } catch (err) {\r\n    return NextResponse.json({ error: String(err) }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function DELETE(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const { id } = await params\r\n    // Soft-delete: mark archived\r\n    const userId = req.headers.get('X-User-Id')\r\n    const conn = await pool.getConnection()\r\n    try {\r\n      await conn.beginTransaction()\r\n      await conn.query(`UPDATE products SET is_archived = TRUE WHERE product_id = ?`, [id])\r\n      if (userId) {\r\n        await conn.query(\r\n          `INSERT INTO audit_logs (user_id, action, table_name, record_id, created_at) VALUES (?, 'DELETE', 'products', ?, NOW())`,\r\n          [userId, id],\r\n        )\r\n      }\r\n      await conn.commit()\r\n      return NextResponse.json({ success: true })\r\n    } catch (err) {\r\n      await conn.rollback()\r\n      throw err\r\n    } finally {\r\n      conn.release()\r\n    }\r\n  } catch (err) {\r\n    return NextResponse.json({ error: String(err) }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;;AAGO,eAAe,IAAI,OAAoB,EAAE,EAAE,MAAM,EAAuC;IAC7F,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,IAAA,oHAAK,EACtB,CAAC,kIAAkI,CAAC,EACpI;YAAC;SAAG;QAEN,IAAI,CAAC,QAAQ,AAAC,KAAa,MAAM,KAAK,GAAG,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;QACxG,OAAO,gJAAY,CAAC,IAAI,CAAC,AAAC,IAAY,CAAC,EAAE;IAC3C,EAAE,OAAO,KAAK;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IACjE;AACF;AAEO,eAAe,IAAI,GAAY,EAAE,EAAE,MAAM,EAAuC;IACrF,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EACJ,IAAI,EACJ,WAAW,EACX,WAAW,EACX,GAAG,EACH,KAAK,EACL,UAAU,EACV,KAAK,EACL,SAAS,EACT,WAAW,EACX,WAAW,EACZ,GAAG;QAEJ,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC;QAC/B,MAAM,OAAO,MAAM,sHAAI,CAAC,aAAa;QACrC,IAAI;YACF,MAAM,KAAK,gBAAgB;YAC3B,MAAM,KAAK,KAAK,CACd,CAAC,mLAAmL,CAAC,EACrL;gBAAC,eAAe;gBAAM;gBAAM,eAAe;gBAAM,OAAO;gBAAM,SAAS;gBAAG,cAAc;gBAAM,SAAS;gBAAG,aAAa;gBAAG,eAAe;gBAAM,cAAc,IAAI;gBAAG;aAAG;YAGzK,IAAI,QAAQ;gBACV,MAAM,KAAK,KAAK,CACd,CAAC,sHAAsH,CAAC,EACxH;oBAAC;oBAAQ;iBAAG;YAEhB;YAEA,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,KAAK,CAC7B,CAAC,kIAAkI,CAAC,EACpI;gBAAC;aAAG;YAEN,MAAM,KAAK,MAAM;YACjB,OAAO,gJAAY,CAAC,IAAI,CAAC,AAAC,IAAY,CAAC,EAAE;QAC3C,EAAE,OAAO,KAAK;YACZ,MAAM,KAAK,QAAQ;YACnB,MAAM;QACR,SAAU;YACR,KAAK,OAAO;QACd;IACF,EAAE,OAAO,KAAK;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IACjE;AACF;AAEO,eAAe,OAAO,GAAY,EAAE,EAAE,MAAM,EAAuC;IACxF,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,6BAA6B;QAC7B,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC;QAC/B,MAAM,OAAO,MAAM,sHAAI,CAAC,aAAa;QACrC,IAAI;YACF,MAAM,KAAK,gBAAgB;YAC3B,MAAM,KAAK,KAAK,CAAC,CAAC,2DAA2D,CAAC,EAAE;gBAAC;aAAG;YACpF,IAAI,QAAQ;gBACV,MAAM,KAAK,KAAK,CACd,CAAC,sHAAsH,CAAC,EACxH;oBAAC;oBAAQ;iBAAG;YAEhB;YACA,MAAM,KAAK,MAAM;YACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC3C,EAAE,OAAO,KAAK;YACZ,MAAM,KAAK,QAAQ;YACnB,MAAM;QACR,SAAU;YACR,KAAK,OAAO;QACd;IACF,EAAE,OAAO,KAAK;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IACjE;AACF"}}]
}