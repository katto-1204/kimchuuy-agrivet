{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/inventory-management-system/lib/db.ts"],"sourcesContent":["import mysql from 'mysql2/promise'\r\n\r\nconst pool = mysql.createPool({\r\n  host: process.env.DB_HOST || '127.0.0.1',\r\n  user: process.env.DB_USER || 'root',\r\n  password: process.env.DB_PASSWORD || '',\r\n  database: process.env.DB_DATABASE || 'kimchuyy_agrivet',\r\n  port: Number(process.env.DB_PORT || 3306),\r\n  waitForConnections: true,\r\n  connectionLimit: 10,\r\n  queueLimit: 0,\r\n})\r\n\r\nexport async function query(sql: string, params?: any[]) {\r\n  const [rows] = await pool.query(sql, params)\r\n  return rows\r\n}\r\n\r\nexport default pool\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,OAAO,8IAAK,CAAC,UAAU,CAAC;IAC5B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IACpC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;AACd;AAEO,eAAe,MAAM,GAAW,EAAE,MAAc;IACrD,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,KAAK,CAAC,KAAK;IACrC,OAAO;AACT;uCAEe"}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/inventory-management-system/app/api/sales/%5Bid%5D/route.ts"],"sourcesContent":["import { query } from \"@/lib/db\"\r\nimport { NextRequest, NextResponse } from \"next/server\"\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> },\r\n) {\r\n  try {\r\n    const { id } = await params\r\n    const saleId = parseInt(id)\r\n\r\n    if (isNaN(saleId)) {\r\n      return NextResponse.json({ error: \"Invalid sale ID\" }, { status: 400 })\r\n    }\r\n\r\n    const saleResults = await query(\r\n      `SELECT s.*, u.full_name as user_name, c.name as customer_name\r\n       FROM sales s\r\n       LEFT JOIN users u ON s.user_id = u.user_id\r\n       LEFT JOIN customers c ON s.customer_id = c.customer_id\r\n       WHERE s.sale_id = ?`,\r\n      [saleId],\r\n    )\r\n\r\n    if ((saleResults as any[]).length === 0) {\r\n      return NextResponse.json({ error: \"Sale not found\" }, { status: 404 })\r\n    }\r\n\r\n    const itemResults = await query(\r\n      `SELECT si.*, p.name as product_name, p.sku\r\n       FROM sale_items si\r\n       JOIN products p ON si.product_id = p.product_id\r\n       WHERE si.sale_id = ?`,\r\n      [saleId],\r\n    )\r\n\r\n    return NextResponse.json({\r\n      sale: (saleResults as any[])[0],\r\n      items: itemResults,\r\n    })\r\n  } catch (error) {\r\n    console.error(\"GET /api/sales/[id] error:\", error)\r\n    return NextResponse.json({ error: \"Failed to fetch sale\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> },\r\n) {\r\n  try {\r\n    const { id } = await params\r\n    const saleId = parseInt(id)\r\n    const userId = request.headers.get(\"X-User-Id\")\r\n\r\n    if (isNaN(saleId)) {\r\n      return NextResponse.json({ error: \"Invalid sale ID\" }, { status: 400 })\r\n    }\r\n\r\n    // Fetch sale and items to restore stock\r\n    const saleResults = await query(\"SELECT * FROM sales WHERE sale_id = ?\", [saleId])\r\n    if ((saleResults as any[]).length === 0) {\r\n      return NextResponse.json({ error: \"Sale not found\" }, { status: 404 })\r\n    }\r\n\r\n    const itemResults = await query(\r\n      \"SELECT * FROM sale_items WHERE sale_id = ?\",\r\n      [saleId],\r\n    )\r\n\r\n    // Restore stock\r\n    for (const item of itemResults as any[]) {\r\n      await query(\r\n        `UPDATE products SET stock = stock + ? WHERE product_id = ?`,\r\n        [item.quantity, item.product_id],\r\n      )\r\n    }\r\n\r\n    // Delete sale items\r\n    await query(\"DELETE FROM sale_items WHERE sale_id = ?\", [saleId])\r\n\r\n    // Soft delete sale (mark as voided)\r\n    await query(\r\n      \"UPDATE sales SET is_voided = TRUE, void_reason = ? WHERE sale_id = ?\",\r\n      [\"User voided\", saleId],\r\n    )\r\n\r\n    // Audit log\r\n    if (userId) {\r\n      await query(\r\n        `INSERT INTO audit_logs (user_id, action, table_name, record_id, created_at)\r\n         VALUES (?, 'DELETE', 'sales', ?, NOW())`,\r\n        [userId, saleId],\r\n      )\r\n    }\r\n\r\n    return NextResponse.json({ message: \"Sale voided successfully\" })\r\n  } catch (error) {\r\n    console.error(\"DELETE /api/sales/[id] error:\", error)\r\n    return NextResponse.json({ error: \"Failed to void sale\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,SAAS,SAAS;QAExB,IAAI,MAAM,SAAS;YACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,cAAc,MAAM,IAAA,oHAAK,EAC7B,CAAC;;;;0BAImB,CAAC,EACrB;YAAC;SAAO;QAGV,IAAI,AAAC,YAAsB,MAAM,KAAK,GAAG;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,cAAc,MAAM,IAAA,oHAAK,EAC7B,CAAC;;;2BAGoB,CAAC,EACtB;YAAC;SAAO;QAGV,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,MAAM,AAAC,WAAqB,CAAC,EAAE;YAC/B,OAAO;QACT;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;AACF;AAEO,eAAe,OACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QACrB,MAAM,SAAS,SAAS;QACxB,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;QAEnC,IAAI,MAAM,SAAS;YACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,wCAAwC;QACxC,MAAM,cAAc,MAAM,IAAA,oHAAK,EAAC,yCAAyC;YAAC;SAAO;QACjF,IAAI,AAAC,YAAsB,MAAM,KAAK,GAAG;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,cAAc,MAAM,IAAA,oHAAK,EAC7B,8CACA;YAAC;SAAO;QAGV,gBAAgB;QAChB,KAAK,MAAM,QAAQ,YAAsB;YACvC,MAAM,IAAA,oHAAK,EACT,CAAC,0DAA0D,CAAC,EAC5D;gBAAC,KAAK,QAAQ;gBAAE,KAAK,UAAU;aAAC;QAEpC;QAEA,oBAAoB;QACpB,MAAM,IAAA,oHAAK,EAAC,4CAA4C;YAAC;SAAO;QAEhE,oCAAoC;QACpC,MAAM,IAAA,oHAAK,EACT,wEACA;YAAC;YAAe;SAAO;QAGzB,YAAY;QACZ,IAAI,QAAQ;YACV,MAAM,IAAA,oHAAK,EACT,CAAC;gDACuC,CAAC,EACzC;gBAAC;gBAAQ;aAAO;QAEpB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA2B;IACjE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC3E;AACF"}}]
}