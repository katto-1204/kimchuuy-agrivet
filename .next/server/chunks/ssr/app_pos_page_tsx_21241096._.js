module.exports=[98704,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(56549),e=a.i(3130),f=a.i(40695),g=a.i(5522),h=a.i(17171),i=a.i(54161),j=a.i(87532),k=a.i(15618),l=a.i(70106);let m=(0,l.default)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var n=a.i(81560),o=a.i(38784);let p=(0,l.default)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),q=(0,l.default)("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),r=(0,l.default)("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);var s=a.i(62213),s=s,t=a.i(71931),u=a.i(34157),u=u,v=a.i(95116),w=a.i(21937);function x(){let{user:a}=(0,w.useAuth)(),[l,x]=(0,c.useState)([]),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)("Cash"),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(null),[S,T]=(0,c.useState)(0),[U,V]=(0,c.useState)(null);(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/products"),b=await a.json();z(b.products||[])}catch(a){console.error("Failed to fetch products:",a),z([])}finally{B(!1)}})()},[]);let W=(0,c.useMemo)(()=>y.filter(a=>{if(a.is_archived||a.stock<=0)return!1;let b=a.name.toLowerCase().includes(C.toLowerCase())||a.sku?.toLowerCase().includes(C.toLowerCase()),c=null===E||a.category_id===E;return b&&c}),[C,E,y]),X=l.reduce((a,b)=>a+b.product.price*b.quantity,0),Y=(X-S)*.12,Z=X-S+Y,$=Number.parseFloat(M||"0")-Z,_=(a,b)=>{x(c=>c.map(c=>{if(c.product.product_id!==a)return c;let d=c.quantity+b;return d<=0||d>c.product.stock?c:{...c,quantity:d}}))},aa=()=>{x([]),T(0),R(null)},ab=async()=>{if(("Cash"!==K||!($<0))&&("Cash"===K||O))try{let b=await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:a?.user_id,customer_id:Q?.customer_id||null,items:l.map(a=>({product_id:a.product.product_id,quantity:a.quantity})),discount:S,vat:Y,total:Z,amount_paid:Number.parseFloat(M||Z.toString()),change_amount:$,payment_method:K,reference_number:O||null})});if(!b.ok){let a=await b.json();alert(`Error: ${a.error}`);return}let c=await b.json();V(c.sale_id),H(!1),J(!0);let d=y.map(a=>{let b=l.find(b=>b.product.product_id===a.product_id);return b?{...a,stock:Math.max(0,a.stock-b.quantity)}:a});z(d)}catch(a){console.error("Payment error:",a),alert("Failed to process payment")}};return(0,b.jsxs)(d.ProtectedLayout,{children:[(0,b.jsxs)("div",{className:"flex h-[calc(100vh-0px)]",children:[(0,b.jsxs)("div",{className:"flex-1 flex flex-col bg-[#F3F4F6] overflow-hidden",children:[(0,b.jsxs)("div",{className:"p-4 bg-card border-b border-border space-y-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(j.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted"}),(0,b.jsx)(g.Input,{type:"search",placeholder:"Search products by name or SKU...",value:C,onChange:a=>D(a.target.value),className:"pl-10 h-11"})]}),(0,b.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-1",children:[(0,b.jsx)(f.Button,{variant:null===E?"default":"outline",size:"sm",onClick:()=>F(null),className:null===E?"bg-primary text-white":"",children:"All"}),v.mockCategories.map(a=>(0,b.jsx)(f.Button,{variant:E===a.category_id?"default":"outline",size:"sm",onClick:()=>F(a.category_id),className:E===a.category_id?"bg-primary text-white":"",children:a.name},a.category_id))]})]}),(0,b.jsxs)("div",{className:"flex-1 p-4 overflow-y-auto",children:[A?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-muted",children:[(0,b.jsx)("div",{className:"h-12 w-12 border-4 border-primary border-t-transparent rounded-full animate-spin mb-4"}),(0,b.jsx)("p",{className:"text-lg font-medium",children:"Loading products..."})]}):(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3",children:W.map(a=>{let c=l.find(b=>b.product.product_id===a.product_id);return(0,b.jsxs)("button",{onClick:()=>{x(b=>{let c=b.find(b=>b.product.product_id===a.product_id);return c?c.quantity>=a.stock?b:b.map(b=>b.product.product_id===a.product_id?{...b,quantity:b.quantity+1}:b):[...b,{product:a,quantity:1}]})},className:"bg-card rounded-xl p-3 text-left hover:shadow-lg transition-shadow border border-border hover:border-primary relative group",children:[c&&(0,b.jsx)(i.Badge,{className:"absolute -top-2 -right-2 bg-primary text-white",children:c.quantity}),(0,b.jsx)("div",{className:"w-full aspect-square bg-muted/30 rounded-lg mb-2 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-3xl text-muted",children:"Feeds"===a.category_name?"ğŸ•":"Medicine"===a.category_name?"ğŸ’Š":"Vitamins"===a.category_name?"ğŸ’‰":"Accessories"===a.category_name?"ğŸ¦´":"ğŸ“¦"})}),(0,b.jsx)("p",{className:"text-sm font-medium text-foreground line-clamp-2 leading-tight",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-muted mt-1",children:a.sku}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,b.jsxs)("p",{className:"text-sm font-bold text-primary",children:["â‚±",a.price.toLocaleString("en-PH")]}),(0,b.jsxs)("p",{className:`text-xs ${a.stock<=a.min_stock?"text-warning":"text-muted"}`,children:[a.stock," left"]})]})]},a.product_id)})}),!A&&0===W.length&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-muted",children:[(0,b.jsx)(j.Search,{className:"h-12 w-12 mb-4"}),(0,b.jsx)("p",{className:"text-lg font-medium",children:"No products found"}),(0,b.jsx)("p",{className:"text-sm",children:"Try a different search term or category"})]})]})]}),(0,b.jsxs)("div",{className:"w-96 bg-card border-l border-border flex flex-col",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-foreground flex items-center gap-2",children:[(0,b.jsx)(o.ShoppingCart,{className:"h-5 w-5 text-primary"}),"Current Order"]}),l.length>0&&(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"text-danger",onClick:aa,children:"Clear"})]}),Q&&(0,b.jsxs)("div",{className:"mt-2 flex items-center justify-between p-2 bg-primary/10 rounded-lg",children:[(0,b.jsx)("span",{className:"text-sm text-primary",children:Q.name}),(0,b.jsx)("button",{onClick:()=>R(null),className:"text-primary hover:text-primary-dark",children:(0,b.jsx)(s.default,{className:"h-4 w-4"})})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:0===l.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-muted",children:[(0,b.jsx)(o.ShoppingCart,{className:"h-16 w-16 mb-4 text-muted/50"}),(0,b.jsx)("p",{className:"font-medium",children:"Cart is empty"}),(0,b.jsx)("p",{className:"text-sm",children:"Add products to start"})]}):l.map(a=>(0,b.jsxs)("div",{className:"bg-muted/30 rounded-lg p-3",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-foreground line-clamp-1",children:a.product.name}),(0,b.jsxs)("p",{className:"text-xs text-muted",children:["â‚±",a.product.price.toLocaleString("en-PH")," each"]})]}),(0,b.jsx)("button",{onClick:()=>{var b;return b=a.product.product_id,void x(a=>a.filter(a=>a.product.product_id!==b))},className:"text-danger hover:bg-danger/10 p-1 rounded",children:(0,b.jsx)(n.Trash2,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:()=>_(a.product.product_id,-1),className:"w-8 h-8 rounded-lg bg-card border border-border flex items-center justify-center hover:bg-muted/50",disabled:a.quantity<=1,children:(0,b.jsx)(m,{className:"h-4 w-4"})}),(0,b.jsx)("span",{className:"w-8 text-center font-medium",children:a.quantity}),(0,b.jsx)("button",{onClick:()=>_(a.product.product_id,1),className:"w-8 h-8 rounded-lg bg-card border border-border flex items-center justify-center hover:bg-muted/50",disabled:a.quantity>=a.product.stock,children:(0,b.jsx)(k.Plus,{className:"h-4 w-4"})})]}),(0,b.jsxs)("p",{className:"font-semibold text-foreground",children:["â‚±",(a.product.price*a.quantity).toLocaleString("en-PH",{minimumFractionDigits:2})]})]})]},a.product.product_id))}),(0,b.jsxs)("div",{className:"border-t border-border p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted",children:"Subtotal"}),(0,b.jsxs)("span",{className:"text-foreground",children:["â‚±",X.toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted",children:"Discount"}),(0,b.jsxs)("span",{className:"text-danger",children:["-â‚±",S.toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted",children:"VAT (12%)"}),(0,b.jsxs)("span",{className:"text-foreground",children:["â‚±",Y.toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),(0,b.jsxs)("div",{className:"flex justify-between pt-2 border-t border-border",children:[(0,b.jsx)("span",{className:"text-lg font-semibold text-foreground",children:"Total"}),(0,b.jsxs)("span",{className:"text-lg font-bold text-primary",children:["â‚±",Z.toLocaleString("en-PH",{minimumFractionDigits:2})]})]})]}),(0,b.jsxs)(f.Button,{className:"w-full h-12 bg-primary hover:bg-primary-dark text-white text-lg font-semibold",disabled:0===l.length,onClick:()=>H(!0),children:[(0,b.jsx)(p,{className:"mr-2 h-5 w-5"}),"Proceed to Payment"]})]})]})]}),G&&(0,b.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:(0,b.jsxs)(e.Card,{className:"w-full max-w-md",children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(e.CardTitle,{children:"Payment"}),(0,b.jsx)("button",{onClick:()=>H(!1),className:"text-muted hover:text-foreground",children:(0,b.jsx)(s.default,{className:"h-5 w-5"})})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"text-center py-4 bg-primary/10 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-muted",children:"Total Amount"}),(0,b.jsxs)("p",{className:"text-3xl font-bold text-primary",children:["â‚±",Z.toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Payment Method"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2",children:[{method:"Cash",icon:q},{method:"GCash",icon:r},{method:"Maya",icon:r},{method:"Bank Transfer",icon:p}].map(({method:a,icon:c})=>(0,b.jsxs)("button",{onClick:()=>L(a),className:`p-3 rounded-lg border-2 flex items-center gap-2 transition-colors ${K===a?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50"}`,children:[(0,b.jsx)(c,{className:"h-5 w-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:a})]},a))})]}),"Cash"===K?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"amount",children:"Amount Received"}),(0,b.jsx)(g.Input,{id:"amount",type:"number",placeholder:"Enter amount",value:M,onChange:a=>N(a.target.value),className:"h-12 text-lg"}),Number.parseFloat(M)>=Z&&(0,b.jsxs)("div",{className:"p-3 bg-success/10 rounded-lg text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted",children:"Change"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-success",children:["â‚±",$.toLocaleString("en-PH",{minimumFractionDigits:2})]})]})]}):(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"reference",children:"Reference Number"}),(0,b.jsx)(g.Input,{id:"reference",placeholder:"Enter reference number",value:O,onChange:a=>P(a.target.value),className:"h-12"})]}),(0,b.jsxs)(f.Button,{className:"w-full h-12 bg-success hover:bg-green-600 text-white text-lg font-semibold",onClick:ab,disabled:"Cash"===K&&$<0||"Cash"!==K&&!O,children:[(0,b.jsx)(u.default,{className:"mr-2 h-5 w-5"}),"Complete Payment"]})]})]})}),I&&(0,b.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:(0,b.jsx)(e.Card,{className:"w-full max-w-sm",children:(0,b.jsxs)(e.CardContent,{className:"p-6",children:[(0,b.jsxs)("div",{className:"text-center border-b border-dashed border-border pb-4 mb-4",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-foreground",children:"Kimchuyy Agrivet Supply"}),(0,b.jsx)("p",{className:"text-xs text-muted mt-1",children:"Sales Receipt"})]}),(0,b.jsxs)("div",{className:"text-xs text-muted space-y-1 border-b border-dashed border-border pb-4 mb-4",children:[(0,b.jsxs)("p",{children:["Receipt #: ",U]}),(0,b.jsxs)("p",{children:["Date: ",new Date().toLocaleString("en-PH")]}),(0,b.jsxs)("p",{children:["Cashier: ",a?.full_name]}),Q&&(0,b.jsxs)("p",{children:["Customer: ",Q.name]})]}),(0,b.jsx)("div",{className:"space-y-2 border-b border-dashed border-border pb-4 mb-4",children:l.map(a=>(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-foreground",children:a.product.name}),(0,b.jsxs)("p",{className:"text-xs text-muted",children:[a.quantity," x â‚±",a.product.price.toLocaleString("en-PH")]})]}),(0,b.jsxs)("p",{className:"text-foreground font-medium",children:["â‚±",(a.product.price*a.quantity).toLocaleString("en-PH",{minimumFractionDigits:2})]})]},a.product.product_id))}),(0,b.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted",children:"Subtotal"}),(0,b.jsxs)("span",{children:["â‚±",X.toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted",children:"Discount"}),(0,b.jsxs)("span",{children:["-â‚±",S.toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted",children:"VAT (12%)"}),(0,b.jsxs)("span",{children:["â‚±",Y.toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),(0,b.jsxs)("div",{className:"flex justify-between font-bold text-lg pt-2 border-t border-dashed border-border",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsxs)("span",{className:"text-primary",children:["â‚±",Z.toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),(0,b.jsxs)("div",{className:"flex justify-between pt-2",children:[(0,b.jsx)("span",{className:"text-muted",children:K}),(0,b.jsxs)("span",{children:["â‚±",Number.parseFloat(M||Z.toString()).toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),"Cash"===K&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted",children:"Change"}),(0,b.jsxs)("span",{children:["â‚±",$.toLocaleString("en-PH",{minimumFractionDigits:2})]})]}),O&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted",children:"Ref #"}),(0,b.jsx)("span",{children:O})]})]}),(0,b.jsx)("div",{className:"text-center mt-6 pt-4 border-t border-dashed border-border",children:(0,b.jsx)("p",{className:"text-xs text-muted",children:"Thank you for your purchase!"})}),(0,b.jsxs)("div",{className:"flex gap-2 mt-6",children:[(0,b.jsxs)(f.Button,{variant:"outline",className:"flex-1 bg-transparent",onClick:()=>window.print(),children:[(0,b.jsx)(t.Printer,{className:"mr-2 h-4 w-4"}),"Print"]}),(0,b.jsx)(f.Button,{className:"flex-1 bg-primary hover:bg-primary-dark text-white",onClick:()=>{aa(),J(!1),N(""),P(""),L("Cash"),V(null),window.location.reload()},children:"Done"})]})]})})})]})}a.s(["default",()=>x],98704)}];

//# sourceMappingURL=app_pos_page_tsx_21241096._.js.map